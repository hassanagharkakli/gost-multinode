## gost-multinode (چند نود Gost)

وضعیت پروژه: پایدار (Stable)  
نسخه انتشار: v1.0.0  
نگهدارنده (Maintainer): **HassanAgh**

این پروژه یک اسکریپت ساده و قابل‌اعتماد برای راه‌اندازی **نود ایران** و چندین **نود خارج** بر پایه ابزار Gost است.

معماری به این صورت است:

- نود ایران: یک سرویس `gost-iran.service` که در داخل ایران اجرا می‌شود و نقش Relay (هاب مرکزی) را دارد.
- نودهای خارج: چند سرویس `gost-foreign@<name>.service` که در خارج از ایران هستند و به نود ایران متصل می‌شوند.

تمام تنظیمات و اسکریپت‌ها برای استفاده ساده و نگهداری آسان طراحی شده‌اند.

---

## پیش‌نیازها

- سیستم‌عامل پیشنهادی: Debian / Ubuntu (یا توزیع‌های سازگار با `systemd`)
- دسترسی روت (root) روی هر دو سرور (ایران و خارج)
- اینترنت روی سرور خارج و دسترسی مناسب روی سرور ایران

---

## نصب روی نود ایران

1. وارد سرور ایران شوید و با کاربر `root` یا با `sudo` فرمان زیر را اجرا کنید:

```bash
curl -fsSL https://raw.githubusercontent.com/hassanagharkakli/gost-multinode/main/install.sh | bash
```

2. پس از اتمام نصب، اسکریپت مدیریت با دستور زیر در دسترس است:

```bash
gost-manager
```

> توجه: `gost-manager` باید با کاربر روت اجرا شود، چون سرویس‌ها و تنظیمات `systemd` را مدیریت می‌کند.

---

## راه‌اندازی نود ایران (Iran Node)

1. روی سرور ایران دستور زیر را اجرا کنید:

```bash
gost-manager
```

2. از منوی اصلی گزینه زیر را انتخاب کنید:

- گزینه `2) Configure Iran relay node`

3. در این مرحله:

- یک **پورت Relay** انتخاب کنید (مثلاً `2222` یا هر پورت آزاد دیگر).
- یک **نام کاربری** برای اتصال نودهای خارج وارد کنید (این را یادتان بماند).
- روش احراز هویت را انتخاب کنید:
  - **Password**: یک پسورد قوی وارد کنید (در صفحه نمایش داده نمی‌شود).
  - **SSH private key**: مسیر فایل کلید خصوصی را وارد کنید (مثلاً `/root/.ssh/id_rsa`).
- در صورت نیاز، یک **لیست مجاز IP** وارد کنید:
  - می‌توانید IP یا CIDR با ویرگول جدا کنید، مثل:
    - `1.2.3.4`
    - `1.2.3.4,5.6.7.8`
    - `10.0.0.0/8,192.168.0.0/16`
  - اگر این فیلد را خالی بگذارید، همه IPها اجازه اتصال خواهند داشت (بهتر است پشت فایروال یا Security Group محدود شود).

4. در پایان، تنظیمات در فایل زیر ذخیره می‌شود:

- `/opt/gost-multinode/config/iran.conf`

5. برای فعال‌سازی و اجرا:

- از منوی اصلی گزینه `3) Start / restart Iran relay service` را انتخاب کنید.

این کار سرویس `gost-iran.service` را فعال و اجرا می‌کند.

---

## راه‌اندازی نود خارج (Foreign Nodes)

روی هر سرور خارج که می‌خواهید به نود ایران وصل شود، مراحل زیر را انجام دهید.

1. اسکریپت را مانند نود ایران نصب کنید:

```bash
curl -fsSL https://raw.githubusercontent.com/hassanagharkakli/gost-multinode/main/install.sh | bash
```

2. اسکریپت مدیریت را اجرا کنید:

```bash
gost-manager
```

3. از منوی اصلی گزینه زیر را انتخاب کنید:

- `4) Add or update a foreign node configuration`

4. در ادامه، مقادیر زیر را وارد کنید:

- **نام نود**: یک نام کوتاه و انگلیسی که فقط شامل حروف، عدد، `-` و `_` باشد، مثلاً:
  - `eu-1`
  - `us_main`
- **IP یا دامنه نود ایران**: همان IP یا Hostname سرور ایران که دسترسی از خارج دارد.
- **پورت Relay روی ایران**: همان پورتی که روی نود ایران تنظیم کرده‌اید (مثلاً `2222`).
- **نام کاربری Relay**: همان یوزری که روی نود ایران تعریف کرده‌اید.
- **روش احراز هویت**:
  - اگر روی نود ایران Password انتخاب کرده‌اید، اینجا هم Password را وارد کنید.
  - اگر روی نود ایران SSH Key انتخاب کرده‌اید، اینجا هم مسیر همان کلید خصوصی (یا کلید مناسب دیگر) را وارد کنید.
- سپس **حداقل یک مپ پورت** تعریف کنید:
  - `Local port`: پورتی که روی نود خارج باز می‌شود (مثلاً `8080`).
  - `Destination port on Iran side`: پورتی که روی نود ایران Relay به آن وصل می‌شود (مثلاً `8080`).
  - می‌توانید چند مپ مختلف تعریف کنید (برای چند سرویس مختلف).

5. تنظیمات در فایل زیر ذخیره می‌شود:

- `/opt/gost-multinode/config/foreign/<name>.conf`

6. برای اجرا:

- از منوی اصلی گزینه `5) Start / restart all foreign node services` را بزنید.

این کار سرویس‌های `gost-foreign@<name>.service` را فعال و اجرا می‌کند (برای هر نود یک سرویس جداگانه).

---

## بررسی وضعیت سرویس‌ها

- در منوی `gost-manager` گزینه `6) Show service status` وضعیت نود ایران و نودهای خارج را با `systemctl` نمایش می‌دهد.

همچنین می‌توانید به صورت مستقیم از دستورات زیر استفاده کنید:

```bash
systemctl status gost-iran.service
systemctl status 'gost-foreign@*.service'
```

---

## حذف کامل (Uninstall)

اگر می‌خواهید `gost-multinode` را از روی سیستم حذف کنید:

1. دستور زیر را با کاربر روت اجرا کنید:

```bash
gost-manager
```

2. در منو، گزینه `7) Uninstall gost-multinode (manager and services)` را انتخاب کنید.

این گزینه:

- سرویس‌های `gost-iran` و `gost-foreign@*` را متوقف و غیرفعال می‌کند.
- پوشه `/opt/gost-multinode` را حذف می‌کند.
- لینک `/usr/bin/gost-manager` را حذف می‌کند.

> توجه: این کار فقط اسکریپت‌ها و تنظیمات `gost-multinode` را حذف می‌کند و باینری `gost` را پاک نمی‌کند (در صورت نیاز می‌توانید آن را جداگانه حذف کنید).

---

## نکات امنیتی

- حتماً از پسوردهای قوی استفاده کنید.
- در حالت امکان، از **SSH Key** به جای پسورد استفاده کنید.
- اگر امکان دارد، روی نود ایران:
  - پورت Relay را در فایروال فقط برای IPهای نودهای خارج باز کنید.
  - از Security Group / UFW / iptables برای محدود کردن دسترسی استفاده کنید.
- مراقب باشید فایل‌های زیر فقط برای کاربر روت قابل‌خواندن باشند:
  - `/opt/gost-multinode/config/iran.conf`
  - `/opt/gost-multinode/config/foreign/*.conf`

---

## توسعه و گزارش باگ

- مخزن پروژه: `https://github.com/hassanagharkakli/gost-multinode`
- نگهدارنده (Maintainer): **HassanAgh**

اگر باگی پیدا کردید یا پیشنهادی داشتید، می‌توانید در GitHub Issue باز کنید.

